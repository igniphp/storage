# ![Igni logo](https://github.com/igniphp/common/blob/master/logo/full.svg)
[![Build Status](https://travis-ci.org/igniphp/storage.svg?branch=master)](https://travis-ci.org/igniphp/storage)
[![Scrutinizer Code Quality](https://scrutinizer-ci.com/g/igniphp/storage/badges/quality-score.png?b=master)](https://scrutinizer-ci.com/g/igniphp/storage/?branch=master)
[![Code Coverage](https://scrutinizer-ci.com/g/igniphp/storage/badges/coverage.png?b=master)](https://scrutinizer-ci.com/g/igniphp/storage/?branch=master)

## Igni Storage
Licensed under MIT License.

## Installation

```
composer install igniphp/storage
```

## Introduction

Igni/storage is minimalistic mapping/hydration library with support for PDO and MongoDB databases with cross database
access. 

Main ideas behind the library are:
- Usage of native query language
- Small learning curve
- Ease of maintenance
- Support for multiple types of databases
- Support for cross database references

## Requirements

 - >= PHP 7.1
 - PDO for mysql, sqlite and/or pgsql support
 - MongoDB extension for mongo support

## Connecting

### Mysql/PgSQL

```php
<?php
use Igni\Storage\Driver\Pdo\Connection;
use Igni\Storage\Driver\Pdo\ConnectionOptions;

$connection = new Connection('localhost', new ConnectionOptions(
    $type = 'mysql',
    $database = 'test',
    $username = 'root',
    $password = 'password'
));
```


### Sqlite

```php
<?php
use Igni\Storage\Driver\Pdo\Connection;
use Igni\Storage\Driver\Pdo\ConnectionOptions;

$connection = new Connection('path/to/database', new ConnectionOptions(
    $type = 'sqlite'
));
```

### MongoDB

```php
<?php
use Igni\Storage\Driver\MongoDB\Connection;
use Igni\Storage\Driver\MongoDb\ConnectionOptions;

$connection = new Connection('localhost', new ConnectionOptions(
    $database = 'test',
    $username = 'test',
    $password = 'password'
));
```

## Mapping

Mapping tells how data that is stored in database should be reflected in your code.

Library provides following tools to map data:
- Entity (unit of data, can be single person, place or thing)
- Repository (manages entities and provides access to your entities)
- Schema (provides detailed information about data transformation from and to database)

### Entity
An entity is an object that exists. It can perform various actions and has its own identity. 
An entity can be a single thing, person, place, or object. Entity defines attributes, which keeps information about
what entity needs in order to live. 

#### Defining Entities
Entity must implement `\Storage\Entity` interface. The interface requires you to define `getId` method.

The simplest entity may look like this:

```php
<?php
use Igni\Storage\Entity;
use Igni\Storage\Id;
use Igni\Storage\Id\Uuid;

class SongEntity implements Entity
{
    private $id;
    
    public function __construct()
    {
        $this->id = new Uuid();
    }
    
    public function getId(): Id
    {
        return $this->id;
    }
}
```

This entity cannot be stored yet. What is missing here is:
- the information where entity should be persisted
- which property keeps entity's identity

This and other meta information can be injected to the entity with annotations. Annotation is a note by way of explanation/comment
added to a code. In php world it is kept in doc block comment prefixed by `@`.

Following example stores song in table/collection named `songs` with identity set on `id` property.

```php
<?php
use Igni\Storage\Entity;
use Igni\Storage\Id;
use Igni\Storage\Id\Uuid;
use Igni\Storage\Mapping\Annotations as Storage;

/**
 * @Storage\Entity(source="albums")
 */
class SongEntity implements Entity
{
    /**
     * @var Uuid
     * @Storage\Types\Id()
     */
    private $id;
    
    public function __construct()
    {
        $this->id = new Uuid();
    }
    
    public function getId(): Id
    {
        return $this->id;
    }
}
```


#### Autogenerated Ids

#### Available types

##### Date

##### Decimal

##### Embed

#### Float

##### Id

##### Integer

##### Reference

##### Text

##### Custom types

### Repositories

#### Defining Repository

#### Registering Repository

#### Working with cursor

### Database Drivers

#### Available drivers

#### Adding custom driver
